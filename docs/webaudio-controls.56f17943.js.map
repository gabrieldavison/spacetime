{"version":3,"sources":["js/engine/webaudio-controls.js"],"names":["window","customElements","styles","document","createElement","innerHTML","head","appendChild","midimenu","id","opt","useMidi","preserveMidiLearn","preserveValue","midilearn","mididump","outline","knobSrc","knobSprites","knobWidth","knobHeight","knobDiameter","knobColors","sliderSrc","sliderWidth","sliderHeight","sliderKnobSrc","sliderKnobWidth","sliderKnobHeight","sliderDitchlength","sliderColors","switchWidth","switchHeight","switchDiameter","switchColors","paramWidth","paramHeight","paramFontSize","paramColors","valuetip","xypadColors","WebAudioControlsOptions","Object","assign","WebAudioControlsWidget","HTMLElement","constructor","addEventListener","keydown","pointerdown","passive","wheel","pointerover","pointerout","contextMenu","hover","drag","body","basestyle","onblur","elem","style","onfocus","sendEvent","ev","event","createEvent","initEvent","dispatchEvent","getAttr","n","def","v","getAttribute","isNaN","showtip","d","s","tooltip","indexOf","ttframe","numformat","x","i","j","length","c","type","m","r","replace","parseInt","valstr","toString","toUpperCase","parseFloat","toFixed","slice","convValue","display","width","height","transition","opacity","visibility","rc","getBoundingClientRect","rc2","documentElement","left","top","setupLabel","labelpos","lpos","split","offs","label","position","transform","e","webAudioControlsWidgetManager","contextMenuOpen","preventDefault","stopPropagation","setMidiController","channel","cc","listeningToThisMidiController","midiController","console","log","processMidiEvent","data","controlNumber","midiMode","contextMenuClose","tagName","setValue","value","els","querySelectorAll","group","val","min","max","define","WebAudioKnob","connectedCallback","root","attachShadow","mode","childNodes","firstChild","nextSibling","enable","_src","defineProperty","get","set","setupImage","_value","redraw","defvalue","_min","_max","_step","_sprites","_width","_height","_diameter","_colors","sensitivity","conv","eval","midicc","ch","substring","lastIndexOf","midiLearnTable","ml","digits","step","_setValue","coltab","addWidget","disconnectedCallback","kw","kh","src","colors","svg","backgroundImage","btoa","backgroundSize","fireflag","img","Image","onload","sprites","ratio","Math","sp","offset","backgroundPosition","deg","round","oldvalue","f","delta","key","deltaY","shiftKey","pow","touches","changedTouches","identifier","buttons","button","focus","pointermove","lastShift","startPosX","pageX","startPosY","pageY","startVal","pointerup","removeEventListener","preventScroll","ctrlKey","metaKey","error","WebAudioSlider","knob","tracking","_knobsrc","_direction","_knobwidth","_knobheight","_ditchlength","onclick","bodyimg","knobimg","srcurl","sw","sh","svgbody","dr","mm","kw2","kh2","svgknob","knobsrcurl","knobsrc","dlen","ditchlength","sensex","sensey","pageXOffset","pageYOffset","invert","checked","WebAudioParam","_fontsize","paramSrc","link","rconv","currentLink","fromLink","target","bind","onchange","imgloaded","fontSize","fontsize","l","getElementById","func","color","backgroundColor","background","cv","ctx","getContext","_values","_keys","press","keycodes1","keycodes2","keyup","bheight","kp","kf","ko","kn","keys","dispvalues","valuesold","rrect","y","w","h","c1","c2","g","createLinearGradient","addColorStop","fillStyle","beginPath","moveTo","lineTo","quadraticCurveTo","fill","fillRect","x0","wwidth","bwidth","h2","strokeStyle","stroke","floor","k","keyCode","currentKey","sendEventFromKey","setNote","p","targetTouches","px","clientX","py","clientY","push","sort","values","sendevent","note","notes","setdispvalues","state","splice","actx","when","t","currentTime","setTimeout","WebAudioControlsWidgetManager","midiAccess","listOfWidgets","listOfExternalMidiListeners","updateWidgets","JSON","parse","localStorage","getItem","initWebAudioControls","navigator","requestMIDIAccess","then","ma","enableInputs","err","code","inputs","size","input","next","done","name","onmidimessage","handleMIDIMessage","midiConnectionStateChange","port","connection","onMIDIStarted","midi","onstatechange","addMidiListener","callback","getCurrentConfigAsJSON","currentConfig","stringify","forEach","externalListener","menu","classList","add","contextMenuCloseByKey","remove","contextMenuLearn","contextMenuClear","setItem","UseWebAudioControlsMidi","webAudioControlsMidiManager"],"mappings":"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","file":"webaudio-controls.56f17943.js","sourceRoot":"../src","sourcesContent":["/* *\n *\n *  WebAudio-Controls is based on\n *    webaudio-knob by Eiji Kitamura http://google.com/+agektmr\n *    webaudio-slider by RYoya Kawai https://plus.google.com/108242669191458983485/posts\n *    webaudio-switch by Keisuke Ai http://d.hatena.ne.jp/aike/\n *  Integrated and enhanced by g200kg http://www.g200kg.com/\n *\n *\tCopyright 2013 Eiji Kitamura / Ryoya KAWAI / Keisuke Ai / g200kg(Tatsuya Shinyagaito)\n *\n *\t Licensed under the Apache License, Version 2.0 (the \"License\");\n *\t you may not use this file except in compliance with the License.\n *\t You may obtain a copy of the License at\n *\n *\t http://www.apache.org/licenses/LICENSE-2.0\n *\n *\t Unless required by applicable law or agreed to in writing, software\n *\t distributed under the License is distributed on an \"AS IS\" BASIS,\n *\t WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\t See the License for the specific language governing permissions and\n *\t limitations under the License.\n *\n * */\nif(window.customElements){\n  let styles=document.createElement(\"style\");\n  styles.innerHTML=\n`#webaudioctrl-context-menu {\n  display: none;\n  position: absolute;\n  z-index: 10;\n  padding: 0;\n  width: 100px;\n  color:#eee;\n  background-color: #268;\n  border: solid 1px #888;\n  box-shadow: 1px 1px 2px #888;\n  font-family: sans-serif;\n  font-size: 11px;\n  line-height:1.7em;\n  text-align:center;\n  cursor:pointer;\n  color:#fff;\n  list-style: none;\n}\n#webaudioctrl-context-menu.active {\n  display: block;\n}\n.webaudioctrl-context-menu__item {\n  display: block;\n  margin: 0;\n  padding: 0;\n  color: #000;\n  background-color:#eee;\n  text-decoration: none;\n}\n.webaudioctrl-context-menu__title{\n  font-weight:bold;\n}\n.webaudioctrl-context-menu__item:last-child {\n  margin-bottom: 0;\n}\n.webaudioctrl-context-menu__item:hover {\n  background-color: #b8b8b8;\n}\n`;\n  document.head.appendChild(styles);\n  let midimenu=document.createElement(\"ul\");\n  midimenu.id=\"webaudioctrl-context-menu\";\n  midimenu.innerHTML=\n`<li class=\"webaudioctrl-context-menu__title\">MIDI Learn</li>\n<li class=\"webaudioctrl-context-menu__item\" id=\"webaudioctrl-context-menu-learn\" onclick=\"webAudioControlsWidgetManager.contextMenuLearn()\">Learn</li>\n<li class=\"webaudioctrl-context-menu__item\" onclick=\"webAudioControlsWidgetManager.contextMenuClear()\">Clear</li>\n<li class=\"webaudioctrl-context-menu__item\" onclick=\"webAudioControlsWidgetManager.contextMenuClose()\">Close</li>\n`;\n  let opt={\n    useMidi:0,\n    preserveMidiLearn:0,\n    preserveValue:0,\n    midilearn:0,\n    mididump:0,\n    outline:null,\n    knobSrc:null,\n    knobSprites:null,\n    knobWidth:null,\n    knobHeight:null,\n    knobDiameter:null,\n    knobColors:\"#e00;#000;#fff\",\n    sliderSrc:null,\n    sliderWidth:null,\n    sliderHeight:null,\n    sliderKnobSrc:null,\n    sliderKnobWidth:null,\n    sliderKnobHeight:null,\n    sliderDitchlength:null,\n    sliderColors:\"#e00;#333;#fcc\",\n    switchWidth:null,\n    switchHeight:null,\n    switchDiameter:null,\n    switchColors:\"#e00;#000;#fcc\",\n    paramWidth:null,\n    paramHeight:null,\n    paramFontSize:9,\n    paramColors:\"#fff;#000\",\n    valuetip:0,\n    xypadColors:\"#e00;#000;#fcc\",\n  };\n  if(window.WebAudioControlsOptions)\n    Object.assign(opt,window.WebAudioControlsOptions);\n  class WebAudioControlsWidget extends HTMLElement{\n    constructor(){\n      super();\n      this.addEventListener(\"keydown\",this.keydown);\n      this.addEventListener(\"mousedown\",this.pointerdown,{passive:false});\n      this.addEventListener(\"touchstart\",this.pointerdown,{passive:false});\n      this.addEventListener(\"wheel\",this.wheel,{passive:false});\n      this.addEventListener(\"mouseover\",this.pointerover);\n      this.addEventListener(\"mouseout\",this.pointerout);\n      this.addEventListener(\"contextmenu\",this.contextMenu);\n      this.hover=this.drag=0;\n      document.body.appendChild(midimenu);\n      this.basestyle=`\n.webaudioctrl-tooltip{\n  display:inline-block;\n  position:absolute;\n  margin:0 -1000px;\n  z-index: 999;\n  background:#eee;\n  color:#000;\n  border:1px solid #666;\n  border-radius:4px;\n  padding:5px 10px;\n  text-align:center;\n  left:0; top:0;\n  font-size:11px;\n  opacity:0;\n  visibility:hidden;\n}\n.webaudioctrl-tooltip:before{\n  content: \"\";\n  position: absolute;\n  top: 100%;\n  left: 50%;\n  margin-left: -8px;\n  border: 8px solid transparent;\n  border-top: 8px solid #666;\n}\n.webaudioctrl-tooltip:after{\n  content: \"\";\n  position: absolute;\n  top: 100%;\n  left: 50%;\n  margin-left: -6px;\n  border: 6px solid transparent;\n  border-top: 6px solid #eee;\n}\n`;\n      this.onblur=()=>{\n        this.elem.style.outline=\"none\";\n      }\n      this.onfocus=()=>{\n        switch(+this.outline){\n        case null:\n        case 0:\n          this.elem.style.outline=\"none\";\n          break;\n        case 1:\n          this.elem.style.outline=\"1px solid #444\";\n          break;\n        default:\n          this.elem.style.outline=this.outline;\n        }\n      }\n    }\n    sendEvent(ev){\n      let event;\n      event=document.createEvent(\"HTMLEvents\");\n      event.initEvent(ev,false,true);\n      this.dispatchEvent(event);\n    }\n    getAttr(n,def){\n      let v=this.getAttribute(n);\n      if(v==null) return def;\n      switch(typeof(def)){\n      case \"number\":\n        if(v==\"true\") return 1;\n        v=+v;\n        if(isNaN(v)) return 0;\n        return v;\n      }\n      return v;\n    }\n    showtip(d){\n      function valstr(x,c,type){\n        switch(type){\n        case \"x\": return (x|0).toString(16);\n        case \"X\": return (x|0).toString(16).toUpperCase();\n        case \"d\": return (x|0).toString();\n        case \"f\": return parseFloat(x).toFixed(c);\n        case \"s\": return x.toString();\n        }\n        return \"\";\n      }\n      function numformat(s,x){\n        let i=s.indexOf(\"%\");\n        let j=i+1;\n        if(i<0)\n          j=s.length;\n        let c=[0,0],type=0,m=0,r=\"\";\n        if(s.indexOf(\"%s\")>=0){\n          return s.replace(\"%s\",x);\n        }\n        for(;j<s.length;++j){\n          if(\"dfxXs\".indexOf(s[j])>=0){\n            type=s[j];\n            break;\n          }\n          if(s[j]==\".\")\n            m=1;\n          else\n            c[m]=c[m]*10+parseInt(s[j]);\n        }\n        r=valstr(x,c[1],type);\n        if(c[0]>0)\n          r=(\"               \"+r).slice(-c[0]);\n        r=s.replace(/%.*[xXdfs]/,r);\n        return r;\n      }\n      let s=this.tooltip;\n      if(this.drag||this.hover){\n        if(this.valuetip){\n          if(s==null)\n            s=`%s`;\n          else if(s.indexOf(\"%\")<0)\n            s+=` : %s`;\n        }\n        if(s){\n          this.ttframe.innerHTML=numformat(s,this.convValue);\n          this.ttframe.style.display=\"inline-block\";\n          this.ttframe.style.width=\"auto\";\n          this.ttframe.style.height=\"auto\";\n          this.ttframe.style.transition=\"opacity 0.5s \"+d+\"s,visibility 0.5s \"+d+\"s\";\n          this.ttframe.style.opacity=0.9;\n          this.ttframe.style.visibility=\"visible\";\n          let rc=this.getBoundingClientRect(),rc2=this.ttframe.getBoundingClientRect(),rc3=document.documentElement.getBoundingClientRect();\n          this.ttframe.style.left=((rc.width-rc2.width)*0.5+1000)+\"px\";\n          this.ttframe.style.top=(-rc2.height-8)+\"px\";\n          return;\n        }\n      }\n      this.ttframe.style.transition=\"opacity 0.1s \"+d+\"s,visibility 0.1s \"+d+\"s\";\n      this.ttframe.style.opacity=0;\n      this.ttframe.style.visibility=\"hidden\";\n    }\n    setupLabel(){\n      this.labelpos=this.getAttr(\"labelpos\", \"bottom 0px\");\n      const lpos=this.labelpos.split(\" \");\n      let offs=\"\";\n      if(lpos.length==3)\n        offs=`translate(${lpos[1]},${lpos[2]})`;\n      this.label.style.position=\"absolute\";\n      switch(lpos[0]){\n      case \"center\":\n        this.label.style.top=\"50%\";\n        this.label.style.left=\"50%\";\n        this.label.style.transform=`translate(-50%,-50%) ${offs}`;\n        break;\n      case \"right\":\n        this.label.style.top=\"50%\";\n        this.label.style.left=\"100%\";\n        this.label.style.transform=`translateY(-50%) ${offs}`;\n        break;\n      case \"left\":\n        this.label.style.top=\"50%\";\n        this.label.style.left=\"0%\";\n        this.label.style.transform=`translate(-100%,-50%) ${offs}`;\n        break;\n      case \"bottom\":\n        this.label.style.top=\"100%\";\n        this.label.style.left=\"50%\";\n        this.label.style.transform=`translateX(-50%) ${offs}`;\n        break;\n      case \"top\":\n        this.label.style.top=\"0%\";\n        this.label.style.left=\"50%\";\n        this.label.style.transform=`translate(-50%,-100%) ${offs}`;\n        break;\n      }\n    }\n    pointerover(e) {\n      this.hover=1;\n      this.showtip(0.6);\n    }\n    pointerout(e) {\n      this.hover=0;\n      this.showtip(0);\n    }\n    contextMenu(e){\n      if(window.webAudioControlsWidgetManager && this.midilearn)\n        webAudioControlsWidgetManager.contextMenuOpen(e,this);\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setMidiController(channel, cc) {\n      if (this.listeningToThisMidiController(channel, cc)) return;\n      this.midiController={ 'channel': channel, 'cc': cc};\n      console.log(\"Added mapping for channel=\" + channel + \" cc=\" + cc + \" tooltip=\" + this.tooltip);\n    }\n    listeningToThisMidiController(channel, cc) {\n      const c = this.midiController;\n      if((c.channel === channel || c.channel < 0) && c.cc === cc)\n        return true;\n      return false;\n    }\n    processMidiEvent(event){\n      const channel = event.data[0] & 0xf;\n      const controlNumber = event.data[1];\n      if(this.midiMode == 'learn') {\n        this.setMidiController(channel, controlNumber);\n        webAudioControlsWidgetManager.contextMenuClose();\n        this.midiMode = 'normal';\n        webAudioControlsWidgetManager.preserveMidiLearn();\n      }\n      if(this.listeningToThisMidiController(channel, controlNumber)) {\n        if(this.tagName==\"WEBAUDIO-SWITCH\"){\n          switch(this.type){\n          case \"toggle\":\n            if(event.data[2]>=64)\n              this.setValue(1-this.value,true);\n            break;\n          case \"kick\":\n            this.setValue(event.data[2]>=64?1:0);\n            break;\n          case \"radio\":\n            let els=document.querySelectorAll(\"webaudio-switch[type='radio'][group='\"+this.group+\"']\");\n            for(let i=0;i<els.length;++i){\n              if(els[i]==this)\n                els[i].setValue(1);\n              else\n                els[i].setValue(0);\n            }\n            break;\n          }\n        }\n        else{\n          const val = this.min+(this.max-this.min)*event.data[2]/127;\n          this.setValue(val, true);\n        }\n      }\n    }\n  }\n\ntry{\n    customElements.define(\"webaudio-knob\", class WebAudioKnob extends WebAudioControlsWidget {\n    constructor(){\n      super();\n    }\n    connectedCallback(){\n      let root;\n      if(this.attachShadow)\n        root=this.attachShadow({mode: 'open'});\n      else\n        root=this;\n      root.innerHTML=\n`<style>\n${this.basestyle}\n:host{\n  display:inline-block;\n  margin:0;\n  padding:0;\n  cursor:pointer;\n  font-family: sans-serif;\n  font-size: 11px;\n}\n.webaudio-knob-body{\n  display:inline-block;\n  position:relative;\n  margin:0;\n  padding:0;\n  vertical-align:bottom;\n  white-space:pre;\n}\n</style>\n<div class='webaudio-knob-body' tabindex='1' touch-action='none'><div class='webaudioctrl-tooltip'></div><div part=\"label\" class=\"webaudioctrl-label\"><slot></slot></div></div>\n`;\n      this.elem=root.childNodes[2];\n      this.ttframe=this.elem.firstChild;\n      this.label=this.ttframe.nextSibling;\n      this.enable=this.getAttr(\"enable\",1);\n      this._src=this.getAttr(\"src\",opt.knobSrc); Object.defineProperty(this,\"src\",{get:()=>{return this._src},set:(v)=>{this._src=v;this.setupImage()}});\n      this._value=this.getAttr(\"value\",0); Object.defineProperty(this,\"value\",{get:()=>{return this._value},set:(v)=>{this._value=v;this.redraw()}});\n      this.defvalue=this.getAttr(\"defvalue\",this._value);\n      this._min=this.getAttr(\"min\",0); Object.defineProperty(this,\"min\",{get:()=>{return this._min},set:(v)=>{this._min=+v;this.redraw()}});\n      this._max=this.getAttr(\"max\",100); Object.defineProperty(this,\"max\",{get:()=>{return this._max},set:(v)=>{this._max=+v;this.redraw()}});\n      this._step=this.getAttr(\"step\",1); Object.defineProperty(this,\"step\",{get:()=>{return this._step},set:(v)=>{this._step=+v;this.redraw()}});\n      this._sprites=this.getAttr(\"sprites\",opt.knobSprites); Object.defineProperty(this,\"sprites\",{get:()=>{return this._sprites},set:(v)=>{this._sprites=v;this.setupImage()}});\n      this._width=this.getAttr(\"width\", null); Object.defineProperty(this,\"width\",{get:()=>{return this._width},set:(v)=>{this._width=v;this.setupImage()}});\n      this._height=this.getAttr(\"height\", null); Object.defineProperty(this,\"height\",{get:()=>{return this._height},set:(v)=>{this._height=v;this.setupImage()}});\n      this._diameter=this.getAttr(\"diameter\", null); Object.defineProperty(this,\"diameter\",{get:()=>{return this._diameter},set:(v)=>{this._diameter=v;this.setupImage()}});\n      this._colors=this.getAttr(\"colors\",opt.knobColors); Object.defineProperty(this,\"colors\",{get:()=>{return this._colors},set:(v)=>{this._colors=v;this.setupImage()}});\n      this.outline=this.getAttr(\"outline\",opt.outline);\n      this.setupLabel();\n      this.log=this.getAttr(\"log\",0);\n      this.sensitivity=this.getAttr(\"sensitivity\",1);\n      this.valuetip=this.getAttr(\"valuetip\",opt.valuetip);\n      this.tooltip=this.getAttr(\"tooltip\",null);\n      this.conv=this.getAttr(\"conv\",null);\n      if(this.conv){\n        const x=this._value;\n        this.convValue=eval(this.conv);\n        if(typeof(this.convValue)==\"function\")\n          this.convValue=this.convValue(x);\n      }\n      else\n        this.convValue=this._value;\n      this.midilearn=this.getAttr(\"midilearn\",opt.midilearn);\n      this.midicc=this.getAttr(\"midicc\",null);\n      this.midiController={};\n      this.midiMode=\"normal\";\n      if(this.midicc) {\n          let ch = parseInt(this.midicc.substring(0, this.midicc.lastIndexOf(\".\"))) - 1;\n          let cc = parseInt(this.midicc.substring(this.midicc.lastIndexOf(\".\") + 1));\n          this.setMidiController(ch, cc);\n      }\n      if(this.midilearn && this.id){\n        if(webAudioControlsWidgetManager && webAudioControlsWidgetManager.midiLearnTable){\n          const ml=webAudioControlsWidgetManager.midiLearnTable;\n          for(let i=0; i < ml.length; ++i){\n            if(ml[i].id==this.id){\n              this.setMidiController(ml[i].cc.channel, ml[i].cc.cc);\n              break;\n            }\n          }\n        }\n      }\n      this.setupImage();\n      this.digits=0;\n      if(this.step && this.step < 1) {\n        for(let n = this.step ; n < 1; n *= 10)\n          ++this.digits;\n      }\n      this._setValue(this._value);\n      this.coltab=[\"#e00\",\"#000\",\"#000\"];\n      if(window.webAudioControlsWidgetManager)\n        window.webAudioControlsWidgetManager.addWidget(this);\n    }\n    disconnectedCallback(){}\n    setupImage(){\n      this.kw=this._width||this._diameter||opt.knobWidth||opt.knobDiameter;\n      this.kh=this._height||this._diameter||opt.knobHeight||opt.knobDiameter;\n      if(!this.src){\n        if(this.colors)\n          this.coltab = this.colors.split(\";\");\n        if(!this.coltab)\n          this.coltab=[\"#e00\",\"#000\",\"#000\"];\n        let svg=\n`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"64\" height=\"6464\" preserveAspectRatio=\"none\">\n<defs>\n  <filter id=\"f1\">\n    <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"0.8\" />\n  </filter>\n  <radialGradient id=\"g1\" cx=\"50%\" cy=\"10%\">\n    <stop offset=\"0%\" stop-color=\"${this.coltab[2]}\"/>\n    <stop offset=\"100%\" stop-color=\"${this.coltab[1]}\"/>\n  </radialGradient>\n  <linearGradient id=\"g2\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n    <stop offset=\"0%\" stop-color=\"#000\" stop-opacity=\"0\"/>\n    <stop offset=\"100%\" stop-color=\"#000\" stop-opacity=\"0.3\"/>\n  </linearGradient>\n  <g id=\"B\">\n    <circle cx=\"32\" cy=\"32\" r=\"31\" fill=\"#000\"/>\n    <circle cx=\"32\" cy=\"32\" r=\"29\" fill=\"url(#g1)\"/>\n    <circle cx=\"32\" cy=\"32\" r=\"29\" fill=\"url(#g2)\"/>\n    <circle cx=\"32\" cy=\"32\" r=\"25\" fill=\"${this.coltab[1]}\" filter=\"url(#f1)\"/>\n    <circle cx=\"32\" cy=\"32\" r=\"29\" fill=\"url(#g2)\"/>\n  </g>\n  <line id=\"K\" x1=\"32\" y1=\"25\" x2=\"32\" y2=\"11\" stroke-linecap=\"round\" stroke-width=\"6\" stroke=\"${this.coltab[0]}\"/>\n</defs>`;\n        for(let i=0;i<101;++i){\n          svg += `<use href=\"#B\" y=\"${64*i}\"/><use href=\"#K\" y=\"${64*i}\" transform=\"rotate(${(-135+270*i/101).toFixed(2)},32,${64*i+32})\"/>`;\n        }\n        svg += \"</svg>\";\n        this.elem.style.backgroundImage = \"url(data:image/svg+xml;base64,\"+btoa(svg)+\")\";\n        if(this.kw==null) this.kw=64;\n        if(this.kh==null) this.kh=64;\n        this.elem.style.backgroundSize = `${this.kw}px ${this.kh*101}px`;\n        this.elem.style.width=this.kw+\"px\";\n        this.elem.style.height=this.kh+\"px\";\n        this.style.height=this.kh+\"px\";\n        this.fireflag=true;\n        this.redraw();\n        return;\n      }\n      else{\n        this.img=new Image();\n        this.img.onload=()=>{\n          this.elem.style.backgroundImage = \"url(\"+(this.src)+\")\";\n          if(this._sprites==null)\n            this._sprites=this.img.height/this.img.width - 1;\n          else\n            this._sprites=+this._sprites;\n          if(this.kw==null) this.kw=this.img.width;\n          if(this.kh==null) this.kh=this.img.height/(this.sprites+1);\n          if(!this.sprites)\n            this.elem.style.backgroundSize = \"100% 100%\";\n          else\n            this.elem.style.backgroundSize = `${this.kw}px ${this.kh*(this.sprites+1)}px`;\n          this.elem.style.width=this.kw+\"px\";\n          this.elem.style.height=this.kh+\"px\";\n          this.style.height=this.kh+\"px\";\n          this.redraw();\n        };\n        this.img.src=this.src;\n      }\n    }\n    redraw() {\n      let ratio;\n      this.digits=0;\n      if(this.step && this.step < 1) {\n        for(let n = this.step ; n < 1; n *= 10)\n          ++this.digits;\n      }\n      if(this.value<this.min){\n        this.value=this.min;\n      }\n      if(this.value>this.max){\n        this.value=this.max;\n      }\n      if(this.log)\n        ratio = Math.log(this.value/this.min) / Math.log(this.max/this.min);\n      else\n        ratio = (this.value - this.min) / (this.max - this.min);\n      let style = this.elem.style;\n      let sp = this.src?this.sprites:100;\n      if(sp>=1){\n        let offset = (sp * ratio) | 0;\n        style.backgroundPosition = \"0px \" + (-offset*this.kh) + \"px\";\n        style.transform = 'rotate(0deg)';\n      } else {\n        let deg = 270 * (ratio - 0.5);\n        style.backgroundPosition=\"0px 0px\";\n        style.transform = 'rotate(' + deg + 'deg)';\n      }\n    }\n    _setValue(v){\n      if(this.step)\n        v=(Math.round((v-this.min)/this.step))*this.step+this.min;\n      this._value=Math.min(this.max,Math.max(this.min,v));\n      if(this._value!=this.oldvalue){\n        this.fireflag=true;\n        this.oldvalue=this._value;\n        if(this.conv){\n          const x=this._value;\n          this.convValue=eval(this.conv);\n          if(typeof(this.convValue)==\"function\")\n            this.convValue=this.convValue(x);\n        }\n        else\n          this.convValue=this._value;\n        if(typeof(this.convValue)==\"number\"){\n          this.convValue=this.convValue.toFixed(this.digits);\n        }\n        this.redraw();\n        this.showtip(0);\n        return 1;\n      }\n      return 0;\n    }\n    setValue(v,f){\n      if(this._setValue(v) && f)\n        this.sendEvent(\"input\"),this.sendEvent(\"change\");\n    }\n    keydown(e){\n      const delta = this.step;\n      if(delta==0)\n        delta=1;\n      switch(e.key){\n      case \"ArrowUp\":\n        this.setValue(this.value+delta,true);\n        break;\n      case \"ArrowDown\":\n        this.setValue(this.value-delta,true);\n        break;\n      default:\n          return;\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    wheel(e) {\n      if (!this.enable)\n        return;\n      if(this.log){\n        let r=Math.log(this.value/this.min)/Math.log(this.max/this.min);\n        let d = (e.deltaY>0?-0.01:0.01);\n        if(!e.shiftKey)\n          d*=5;\n        r += d;\n        this.setValue(this.min*Math.pow(this.max/this.min,r),true);\n      }\n      else{\n        let delta=Math.max(this.step, (this.max-this.min)*0.05);\n        if(e.shiftKey)\n          delta=this.step?this.step:1;\n        delta=e.deltaY>0?-delta:delta;\n        this.setValue(+this.value+delta,true);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    pointerdown(ev){\n      if(!this.enable)\n        return;\n      let e=ev;\n      if(ev.touches){\n        e = ev.changedTouches[0];\n        this.identifier=e.identifier;\n      }\n      else {\n        if(e.buttons!=1 && e.button!=0)\n          return;\n      }\n      this.elem.focus();\n      this.drag=1;\n      this.showtip(0);\n      this.oldvalue=this._value;\n      let pointermove=(ev)=>{\n        let e=ev;\n        if(ev.touches){\n          for(let i=0;i<ev.touches.length;++i){\n            if(ev.touches[i].identifier==this.identifier){\n              e = ev.touches[i];\n              break;\n            }\n          }\n        }\n        if(this.lastShift !== e.shiftKey) {\n          this.lastShift = e.shiftKey;\n          this.startPosX = e.pageX;\n          this.startPosY = e.pageY;\n          this.startVal = this.value;\n        }\n        let offset = (this.startPosY - e.pageY - this.startPosX + e.pageX) * this.sensitivity;\n        if(this.log){\n          let r = Math.log(this.startVal / this.min) / Math.log(this.max / this.min);\n          r += offset/((e.shiftKey?4:1)*128);\n          if(r<0) r=0;\n          if(r>1) r=1;\n          this._setValue(this.min * Math.pow(this.max/this.min, r));\n        }\n        else{\n          this._setValue(this.min + ((((this.startVal + (this.max - this.min) * offset / ((e.shiftKey ? 4 : 1) * 128)) - this.min) / this.step) | 0) * this.step);\n        }\n        if(this.fireflag){\n          this.sendEvent(\"input\");\n          this.fireflag=false;\n        }\n        if(e.preventDefault)\n          e.preventDefault();\n        if(e.stopPropagation)\n          e.stopPropagation();\n        return false;\n      }\n      let pointerup=(ev)=>{\n        let e=ev;\n        if(ev.touches){\n          for(let i=0;;){\n            if(ev.changedTouches[i].identifier==this.identifier){\n              break;\n            }\n            if(++i>=ev.changedTouches.length)\n              return;\n          }\n        }\n        this.drag=0;\n        this.showtip(0);\n        this.startPosX = this.startPosY = null;\n        window.removeEventListener('mousemove', pointermove);\n        window.removeEventListener('touchmove', pointermove, {passive:false});\n        window.removeEventListener('mouseup', pointerup);\n        window.removeEventListener('touchend', pointerup);\n        window.removeEventListener('touchcancel', pointerup);\n        document.body.removeEventListener('touchstart', preventScroll,{passive:false});\n        this.sendEvent(\"change\");\n      }\n      let preventScroll=(e)=>{\n        e.preventDefault();\n      }\n      if(e.ctrlKey || e.metaKey)\n        this.setValue(this.defvalue,true);\n      else {\n        this.startPosX = e.pageX;\n        this.startPosY = e.pageY;\n        this.startVal = this.value;\n        window.addEventListener('mousemove', pointermove);\n        window.addEventListener('touchmove', pointermove, {passive:false});\n      }\n      window.addEventListener('mouseup', pointerup);\n      window.addEventListener('touchend', pointerup);\n      window.addEventListener('touchcancel', pointerup);\n      document.body.addEventListener('touchstart', preventScroll,{passive:false});\n      ev.preventDefault();\n      ev.stopPropagation();\n      return false;\n    }\n  });\n} catch(error){\n  console.log(\"webaudio-knob already defined\");\n}\n\ntry{\n  customElements.define(\"webaudio-slider\", class WebAudioSlider extends WebAudioControlsWidget {\n    constructor(){\n      super();\n    }\n    connectedCallback(){\n      let root;\n      if(this.attachShadow)\n        root=this.attachShadow({mode: 'open'});\n      else\n        root=this;\n      root.innerHTML=\n`<style>\n${this.basestyle}\n:host{\n  display:inline-block;\n  position:relative;\n  margin:0;\n  padding:0;\n  font-family: sans-serif;\n  font-size: 11px;\n  cursor:pointer;\n}\n.webaudio-slider-body{\n  display:inline-block;\n  position:relative;\n  margin:0;\n  padding:0;\n  vertical-align:bottom;\n  white-space:pre;\n}\n.webaudio-slider-knob{\n  display:inline-block;\n  position:absolute;\n  margin:0;\n  padding:0;\n}\n</style>\n<div class='webaudio-slider-body' tabindex='1' touch-action='none'><div class='webaudio-slider-knob' touch-action='none'></div><div class='webaudioctrl-tooltip'></div><div part=\"label\" class=\"webaudioctrl-label\"><slot></slot></div></div>\n`;\n      this.elem=root.childNodes[2];\n      this.knob=this.elem.firstChild;\n      this.ttframe=this.knob.nextSibling;\n      this.label=this.ttframe.nextSibling;\n      this.enable=this.getAttr(\"enable\",1);\n      this.tracking=this.getAttr(\"tracking\",\"rel\"); \n      this._src=this.getAttr(\"src\",opt.sliderSrc); Object.defineProperty(this,\"src\",{get:()=>{return this._src},set:(v)=>{this._src=v;this.setupImage()}});\n      this._knobsrc=this.getAttr(\"knobsrc\",opt.sliderKnobSrc); Object.defineProperty(this,\"knobsrc\",{get:()=>{return this._knobsrc},set:(v)=>{this._knobsrc=v;this.setupImage()}});\n      this._value=this.getAttr(\"value\",0); Object.defineProperty(this,\"value\",{get:()=>{return this._value},set:(v)=>{this._value=v;this.redraw()}});\n      this.defvalue=this.getAttr(\"defvalue\",this._value);\n      this._min=this.getAttr(\"min\",0); Object.defineProperty(this,\"min\",{get:()=>{return this._min},set:(v)=>{this._min=v;this.redraw()}});\n      this._max=this.getAttr(\"max\",100); Object.defineProperty(this,\"max\",{get:()=>{return this._max},set:(v)=>{this._max=v;this.redraw()}});\n      this._step=this.getAttr(\"step\",1); Object.defineProperty(this,\"step\",{get:()=>{return this._step},set:(v)=>{this._step=v;this.redraw()}});\n      this._sprites=this.getAttr(\"sprites\",0); Object.defineProperty(this,\"sprites\",{get:()=>{return this._sprites},set:(v)=>{this._sprites=v;this.setupImage()}});\n      this._direction=this.getAttr(\"direction\",null); Object.defineProperty(this,\"direction\",{get:()=>{return this._direction},set:(v)=>{this._direction=v;this.setupImage()}});\n      this.log=this.getAttr(\"log\",0);\n      this._width=this.getAttr(\"width\",opt.sliderWidth); Object.defineProperty(this,\"width\",{get:()=>{return this._width},set:(v)=>{this._width=v;this.setupImage()}});\n      this._height=this.getAttr(\"height\",opt.sliderHeight); Object.defineProperty(this,\"height\",{get:()=>{return this._height},set:(v)=>{this._height=v;this.setupImage()}});\n      this._knobwidth=this.getAttr(\"knobwidth\",opt.sliderKnobWidth); Object.defineProperty(this,\"knobwidth\",{get:()=>{return this._knobwidth},set:(v)=>{this._knobwidth=v;this.setupImage()}});\n      this._knobheight=this.getAttr(\"knobheight\",opt.sliderKnobHeight); Object.defineProperty(this,\"knobheight\",{get:()=>{return this._knobheight},set:(v)=>{this._knobheight=v;this.setupImage()}});\n      this._ditchlength=this.getAttr(\"ditchlength\",opt.sliderDitchlength); Object.defineProperty(this,\"ditchlength\",{get:()=>{return this._ditchlength},set:(v)=>{this._ditchlength=v;this.setupImage()}});\n      this._colors=this.getAttr(\"colors\",opt.sliderColors); Object.defineProperty(this,\"colors\",{get:()=>{return this._colors},set:(v)=>{this._colors=v;this.setupImage()}});\n      this.outline=this.getAttr(\"outline\",opt.outline);\n      this.setupLabel();\n      this.sensitivity=this.getAttr(\"sensitivity\",1);\n      this.valuetip=this.getAttr(\"valuetip\",opt.valuetip);\n      this.tooltip=this.getAttr(\"tooltip\",null);\n      this.conv=this.getAttr(\"conv\",null);\n      if(this.conv){\n        const x=this._value;\n        this.convValue=eval(this.conv);\n        if(typeof(this.convValue)==\"function\")\n          this.convValue=this.convValue(x);\n      }\n      else\n        this.convValue=this._value;\n      this.midilearn=this.getAttr(\"midilearn\",opt.midilearn);\n      this.midicc=this.getAttr(\"midicc\",null);\n      this.midiController={};\n      this.midiMode=\"normal\";\n      if(this.midicc) {\n          let ch = parseInt(this.midicc.substring(0, this.midicc.lastIndexOf(\".\"))) - 1;\n          let cc = parseInt(this.midicc.substring(this.midicc.lastIndexOf(\".\") + 1));\n          this.setMidiController(ch, cc);\n      }\n      if(this.midilearn && this.id){\n        if(webAudioControlsWidgetManager && webAudioControlsWidgetManager.midiLearnTable){\n          const ml=webAudioControlsWidgetManager.midiLearnTable;\n          for(let i=0; i < ml.length; ++i){\n            if(ml[i].id==this.id){\n              this.setMidiController(ml[i].cc.channel, ml[i].cc.cc);\n              break;\n            }\n          }\n        }\n      }\n      this.setupImage();\n      this.digits=0;\n      if(this.step && this.step < 1) {\n        for(let n = this.step ; n < 1; n *= 10)\n          ++this.digits;\n      }\n      this.fireflag=true;\n      if(window.webAudioControlsWidgetManager)\n//        window.webAudioControlsWidgetManager.updateWidgets();\n        window.webAudioControlsWidgetManager.addWidget(this);\n      this.elem.onclick=(e)=>{e.stopPropagation()};\n    }\n    disconnectedCallback(){}\n    setupImage(){\n      this.coltab = this.colors.split(\";\");\n      this.bodyimg=new Image();\n      this.knobimg=new Image();\n      this.srcurl=null;\n      if(this.src==null||this.src==\"\"){\n        this.sw=+this._width;\n        this.sh=+this.height;\n        if(this._direction==\"horz\"){\n          if(this._width==null) this.sw=128;\n          if(this._height==null) this.sh=24;\n        }\n        else if(this._direction==\"vert\"){\n          if(this._width==null) this.sw=24;\n          if(this._height==null) this.sh=128;\n        }\n        else{\n          if(this._width==null) this.sw=128;\n          if(this._height==null) this.sh=24;\n        }\n        const r=Math.min(this.sw,this.sh)*0.5;\n        const svgbody=\n`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${this.sw}\" height=\"${this.sh}\" preserveAspectRatio=\"none\">\n<defs>\n  <filter id=\"f1\">\n    <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"0.8\" />\n  </filter>\n  <linearGradient id=\"g1\" x1=\"0%\" y1=\"0%\" ${(this.sw>this.sh)?'x2=\"0%\" y2=\"100%\"':'x2=\"100%\" y2=\"0%\"'}>\n    <stop offset=\"0%\" stop-color=\"#000\" stop-opacity=\"0\"/>\n    <stop offset=\"100%\" stop-color=\"#000\" stop-opacity=\"0.3\"/>\n  </linearGradient>\n</defs>\n<rect x=\"1\" y=\"1\" rx=\"${r}\" ry=\"${r}\" width=\"${this.sw-2}\" height=\"${this.sh-2}\" fill=\"#000\"/>\n<rect x=\"3\" y=\"3\" rx=\"${r}\" ry=\"${r}\" width=\"${this.sw-6}\" height=\"${this.sh-6}\" fill=\"${this.coltab[1]}\" filter=\"url(#f1)\"/>\n<rect x=\"1\" y=\"1\" rx=\"${r}\" ry=\"${r}\" width=\"${this.sw-2}\" height=\"${this.sh-2}\" fill=\"url(#g1)\"/>\n</svg>`;\n        this.srcurl = \"data:image/svg+xml;base64,\"+btoa(svgbody);\n      }\n      else{\n        this.srcurl = this.src;\n      }\n      this.bodyimg.onload=()=>{\n        if(this.src!=\"\")\n          this.elem.style.backgroundImage = \"url(\"+this.srcurl+\")\";\n        this.sw=+this._width;\n        this.sh=+this._height;\n        if(this._width==null) this.sw=this.bodyimg.width;\n        if(this._height==null) this.sh=this.bodyimg.height;\n        if(this.dr==null){\n          if(this.sw>this.sh)\n            this.dr=\"horz\";\n          else\n            this.dr=\"vert\";\n        }\n        this.kw=+this._knobwidth;\n        this.kh=+this._knobheight;\n        if(this._knobsrc==null){\n          if(this._knobwidth==null) this.kw=Math.min(this.sw,this.sh);\n          if(this._knobheight==null) this.kh=Math.min(this.sw,this.sh);\n          const mm=Math.min(this.kw,this.kh)*0.5;\n          const kw2=Math.max(1,this.kw-12);\n          const kh2=Math.max(1,this.kh-12);\n          const svgknob=\n`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${this.kw}\" height=\"${this.kh}\" preserveAspectRatio=\"none\">\n<defs>\n  <filter id=\"f1\">\n    <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"0.8\" />\n  </filter>\n  <linearGradient id=\"g1\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n    <stop offset=\"0%\" stop-color=\"${this.coltab[2]}\"/>\n    <stop offset=\"50%\" stop-color=\"${this.coltab[0]}\"/>\n    <stop offset=\"100%\" stop-color=\"${this.coltab[0]}\" stop-opacity=\"0.5\"/>\n  </linearGradient>\n  <linearGradient id=\"g2\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n    <stop offset=\"0%\" stop-color=\"${this.coltab[0]}\"/>\n    <stop offset=\"100%\" stop-color=\"${this.coltab[0]}\"/>\n  </linearGradient>\n  <linearGradient id=\"g3\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n    <stop offset=\"0%\" stop-color=\"#000\" stop-opacity=\"0\"/>\n    <stop offset=\"100%\" stop-color=\"#000\" stop-opacity=\"0.3\"/>\n  </linearGradient>\n</defs>\n<rect x=\"2\" y=\"2\" width=\"${this.kw-4}\" height=\"${this.kh-4}\" rx=\"${mm}\" ry=\"${mm}\" fill=\"#000\"/>\n<rect x=\"3\" y=\"3\" width=\"${this.kw-6}\" height=\"${this.kh-6}\" rx=\"${mm}\" ry=\"${mm}\" fill=\"url(#g1)\"/>\n<rect x=\"6\" y=\"6\" width=\"${kw2}\" height=\"${kh2}\" rx=\"${mm}\" ry=\"${mm}\" fill=\"url(#g2)\" filter=\"url(#f1)\"/>\n<rect x=\"3\" y=\"3\" width=\"${this.kw-6}\" height=\"${this.kh-6}\" rx=\"${mm}\" ry=\"${mm}\" fill=\"url(#g3)\"/>\n</svg>`;\n          this.knobsrcurl = \"data:image/svg+xml;base64,\"+btoa(svgknob);\n        }\n        else{\n          this.knobsrcurl = this.knobsrc;\n        }\n        this.knobimg.onload=()=>{\n          this.knob.style.backgroundImage = \"url(\"+this.knobsrcurl+\")\";\n          if(this._knobwidth==null) this.kw=this.knobimg.width;\n          if(this._knobheight==null) this.kh=this.knobimg.height;\n          this.dlen=this.ditchlength;\n          if(this.dlen==null){\n            if(this.dr==\"horz\")\n              this.dlen=this.sw-this.kw;\n            else\n              this.dlen=this.sh-this.kh;\n          }\n          this.knob.style.backgroundSize = \"100% 100%\";\n          this.knob.style.width = this.kw+\"px\";\n          this.knob.style.height = this.kh+\"px\";\n          this.elem.style.backgroundSize = \"100% 100%\";\n          this.elem.style.width=this.sw+\"px\";\n          this.elem.style.height=this.sh+\"px\";\n          this.redraw();\n        };\n        this.knobimg.src=this.knobsrcurl;\n      };\n      this.bodyimg.src=this.srcurl;\n    }\n    redraw() {\n      let ratio;\n      this.digits=0;\n      if(this.step && this.step < 1) {\n        for(let n = this.step ; n < 1; n *= 10)\n          ++this.digits;\n      }\n      if(this.value<this.min){\n        this.value=this.min;\n      }\n      if(this.value>this.max){\n        this.value=this.max;\n      }\n      if(this.log)\n        ratio = Math.log(this.value/this.min) / Math.log(this.max/this.min);\n      else\n        ratio = (this.value - this.min) / (this.max - this.min);\n      let style = this.knob.style;\n      if(this.dr==\"horz\"){\n        style.top=(this.sh-this.kh)*0.5+\"px\";\n        style.left=((this.sw-this.kw-this.dlen)*0.5+ratio*this.dlen)+\"px\";\n        this.sensex=1; this.sensey=0;\n      }\n      else{\n        style.left=(this.sw-this.kw)*0.5+\"px\";\n        style.top=((this.sh-this.kh-this.dlen)*0.5+(1-ratio)*this.dlen)+\"px\";\n        this.sensex=0; this.sensey=1;\n      }\n    }\n    _setValue(v){\n      v=(Math.round((v-this.min)/this.step))*this.step+this.min;\n      this._value=Math.min(this.max,Math.max(this.min,v));\n      if(this._value!=this.oldvalue){\n        this.oldvalue=this._value;\n        this.fireflag=true;\n        if(this.conv){\n          const x=this._value;\n          this.convValue=eval(this.conv);\n          if(typeof(this.convValue)==\"function\")\n            this.convValue=this.convValue(x);\n        }\n        else\n          this.convValue=this._value;\n        if(typeof(this.convValue)==\"number\"){\n          this.convValue=this.convValue.toFixed(this.digits);\n        }\n        this.redraw();\n        this.showtip(0);\n        return 1;\n      }\n      return 0;\n    }\n    setValue(v,f){\n      if(this._setValue(v)&&f)\n        this.sendEvent(\"input\"),this.sendEvent(\"change\");\n    }\n    keydown(e){\n      const delta = this.step;\n      if(delta==0)\n        delta=1;\n      switch(e.key){\n      case \"ArrowUp\":\n        this.setValue(this.value+delta,true);\n        break;\n      case \"ArrowDown\":\n        this.setValue(this.value-delta,true);\n        break;\n      default:\n          return;\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    wheel(e) {\n      if (!this.enable)\n        return;\n      if(this.log){\n        let r=Math.log(this.value/this.min)/Math.log(this.max/this.min);\n        let d = (e.deltaY>0?-0.01:0.01);\n        if(!e.shiftKey)\n          d*=5;\n        r += d;\n        this.setValue(this.min*Math.pow(this.max/this.min,r),true);\n      }\n      else{\n        let delta=Math.max(this.step, (this.max-this.min)*0.05);\n        if(e.shiftKey)\n          delta=this.step?this.step:1;\n        delta=e.deltaY>0?-delta:delta;\n        this.setValue(+this.value+delta,true);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    pointerdown(ev){\n      if(!this.enable)\n        return;\n      let e=ev;\n      if(ev.touches){\n        e = ev.changedTouches[0];\n        this.identifier=e.identifier;\n      }\n      else {\n        if(e.buttons!=1 && e.button!=0)\n          return;\n      }\n      this.elem.focus();\n      this.drag=1;\n      this.showtip(0);\n      let pointermove=(ev)=>{\n        let e=ev;\n        if(ev.touches){\n          for(let i=0;i<ev.touches.length;++i){\n            if(ev.touches[i].identifier==this.identifier){\n              e = ev.touches[i];\n              break;\n            }\n          }\n        }\n        if(this.lastShift !== e.shiftKey) {\n          this.lastShift = e.shiftKey;\n          this.startPosX = e.pageX;\n          this.startPosY = e.pageY;\n          this.startVal = this.value;\n        }\n        if(this.tracking==\"abs\"){\n          const rc = this.getBoundingClientRect();\n          let val;\n          if(this.dr==\"horz\")\n            val = Math.max(0,Math.min(1,(e.pageX-rc.left-window.pageXOffset-this.kw*0.5)/(this.width-this.kw)));\n          else\n            val = 1 - Math.max(0,Math.min(1,(e.pageY-rc.top-window.pageYOffset-this.kh*0.5)/(this.height-this.kh)));\n          if(this.log){\n            this._setValue(this.min * Math.pow(this.max/this.min, val));\n          }\n          else\n            this._setValue(this.min + (this.max - this.min)*val);\n        }\n        else{\n          let offset = ((this.startPosY - e.pageY)*this.sensey - (this.startPosX - e.pageX)*this.sensex) * this.sensitivity;\n          if(this.log){\n            let r = Math.log(this.startVal / this.min) / Math.log(this.max / this.min);\n            r += offset/((e.shiftKey?4:1)*128);\n            if(r<0) r=0;\n            if(r>1) r=1;\n            this._setValue(this.min * Math.pow(this.max/this.min, r));\n          }\n          else{\n            this._setValue(this.min + ((((this.startVal + (this.max - this.min) * offset / ((e.shiftKey ? 4 : 1) * this.dlen)) - this.min) / this.step) | 0) * this.step);\n          }\n        }\n        if(this.fireflag){\n          this.sendEvent(\"input\");\n          this.fireflag=false;\n        }\n        if(e.preventDefault)\n          e.preventDefault();\n        if(e.stopPropagation)\n          e.stopPropagation();\n        return false;\n      }\n      let pointerup=(ev)=>{\n        let e=ev;\n        if(ev.touches){\n          for(let i=0;;){\n            if(ev.changedTouches[i].identifier==this.identifier){\n              break;\n            }\n            if(++i>=ev.changedTouches.length)\n              return;\n          }\n        }\n        this.drag=0;\n        this.showtip(0);\n        this.startPosX = this.startPosY = null;\n        window.removeEventListener('mousemove', pointermove);\n        window.removeEventListener('touchmove', pointermove, {passive:false});\n        window.removeEventListener('mouseup', pointerup);\n        window.removeEventListener('touchend', pointerup);\n        window.removeEventListener('touchcancel', pointerup);\n        document.body.removeEventListener('touchstart', preventScroll,{passive:false});\n        this.sendEvent(\"change\");\n      }\n      let preventScroll=(e)=>{\n        e.preventDefault();\n      }\n      if(e.touches)\n        e = e.touches[0];\n      if(e.ctrlKey || e.metaKey)\n        this.setValue(this.defvalue,true);\n      else {\n        this.startPosX = e.pageX;\n        this.startPosY = e.pageY;\n        this.startVal = this.value;\n        window.addEventListener('mousemove', pointermove);\n        window.addEventListener('touchmove', pointermove, {passive:false});\n        pointermove(ev);\n      }\n      window.addEventListener('mouseup', pointerup);\n      window.addEventListener('touchend', pointerup);\n      window.addEventListener('touchcancel', pointerup);\n      document.body.addEventListener('touchstart', preventScroll,{passive:false});\n      e.preventDefault();\n      e.stopPropagation();\n      return false;\n    }\n  });\n} catch(error){\n  console.log(\"webaudio-slider already defined\");\n}\n\ntry{\n  customElements.define(\"webaudio-switch\", class WebAudioSwitch extends WebAudioControlsWidget {\n    constructor(){\n      super();\n    }\n    connectedCallback(){\n      let root;\n      if(this.attachShadow)\n        root=this.attachShadow({mode: 'open'});\n      else\n        root=this;\n      root.innerHTML=\n`<style>\n${this.basestyle}\n:host{\n  display:inline-block;\n  position:relative;\n  margin:0;\n  padding:0;\n  font-family: sans-serif;\n  font-size: 11px;\n  cursor:pointer;\n}\n.webaudio-switch-body{\n  display:inline-block;\n  position:relative;\n  margin:0;\n  padding:0;\n  vertical-align:bottom;\n  white-space:pre;\n}\n.webaudioctrl-label{\n  position:absolute;\n  left:50%;\n  top:50%;\n}\n</style>\n<div class='webaudio-switch-body' tabindex='1' touch-action='none'><div class='webaudioctrl-tooltip'></div><div part=\"label\" class=\"webaudioctrl-label\"><slot></slot></div></div>\n`;\n      this.elem=root.childNodes[2];\n      this.ttframe=this.elem.firstChild;\n      this.label=this.ttframe.nextSibling;\n      this.enable=this.getAttr(\"enable\",1);\n      this._src=this.getAttr(\"src\",null); Object.defineProperty(this,\"src\",{get:()=>{return this._src},set:(v)=>{this._src=v;this.setupImage()}});\n      this._value=this.getAttr(\"value\",0); Object.defineProperty(this,\"value\",{get:()=>{return this._value},set:(v)=>{this._value=v;this.redraw()}});\n      this.defvalue=this.getAttr(\"defvalue\",this._value);\n      this.type=this.getAttr(\"type\",\"toggle\");\n      this.group=this.getAttr(\"group\",\"\");\n      this._width=this.getAttr(\"width\",null); Object.defineProperty(this,\"width\",{get:()=>{return this._width},set:(v)=>{this._width=v;this.setupImage()}});\n      this._height=this.getAttr(\"height\",null); Object.defineProperty(this,\"height\",{get:()=>{return this._height},set:(v)=>{this._height=v;this.setupImage()}});\n      this._diameter=this.getAttr(\"diameter\",null); Object.defineProperty(this,\"diameter\",{get:()=>{return this._diameter},set:(v)=>{this._diameter=v;this.setupImage()}});\n      this.invert=this.getAttr(\"invert\",0);\n      this._colors=this.getAttr(\"colors\",opt.switchColors); Object.defineProperty(this,\"colors\",{get:()=>{return this._colors},set:(v)=>{this._colors=v;this.setupImage()}});\n      this.outline=this.getAttr(\"outline\",opt.outline);\n      this.setupLabel();\n      this.valuetip=0;\n      this.tooltip=this.getAttr(\"tooltip\",null);\n      this.midilearn=this.getAttr(\"midilearn\",opt.midilearn);\n      this.midicc=this.getAttr(\"midicc\",null);\n      this.midiController={};\n      this.midiMode=\"normal\";\n      if(this.midicc) {\n          let ch = parseInt(this.midicc.substring(0, this.midicc.lastIndexOf(\".\"))) - 1;\n          let cc = parseInt(this.midicc.substring(this.midicc.lastIndexOf(\".\") + 1));\n          this.setMidiController(ch, cc);\n      }\n      if(this.midilearn && this.id){\n        if(webAudioControlsWidgetManager && webAudioControlsWidgetManager.midiLearnTable){\n          const ml=webAudioControlsWidgetManager.midiLearnTable;\n          for(let i=0; i < ml.length; ++i){\n            if(ml[i].id==this.id){\n              this.setMidiController(ml[i].cc.channel, ml[i].cc.cc);\n              break;\n            }\n          }\n        }\n      }\n      this.setupImage();\n      this.digits=0;\n      if(this.step && this.step < 1) {\n        for(let n = this.step ; n < 1; n *= 10)\n          ++this.digits;\n      }\n      if(window.webAudioControlsWidgetManager)\n//        window.webAudioControlsWidgetManager.updateWidgets();\n        window.webAudioControlsWidgetManager.addWidget(this);\n      this.elem.onclick=(e)=>{e.stopPropagation()};\n    }\n    disconnectedCallback(){}\n    setupImage(){\n      this.coltab = this.colors.split(\";\");\n      this.kw=this._width||this._diameter||opt.switchWidth||opt.switchDiameter;\n      this.kh=this._height||this._diameter||opt.switchHeight||opt.switchDiameter;\n      this.img=new Image();\n      this.srcurl=null;\n      if(this.src==null||this.src==\"\"){\n        if(this.kw==null) this.kw=32;\n        if(this.kh==null) this.kh=32;\n        const mm=Math.min(this.kw,this.kh);\n        const kw=this.kw,kh=this.kh;\n        const svg=\n`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${this.kw}\" height=\"${this.kh*2}\" preserveAspectRatio=\"none\">\n<defs>\n<linearGradient id=\"g1\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n  <stop offset=\"0%\" stop-color=\"#000\" stop-opacity=\"0\"/>\n  <stop offset=\"100%\" stop-color=\"#000\" stop-opacity=\"0.2\"/>\n</linearGradient>\n<radialGradient id=\"g2\" cx=\"50%\" cy=\"30%\">\n    <stop offset=\"0%\" stop-color=\"${this.coltab[2]}\"/>\n    <stop offset=\"100%\" stop-color=\"${this.coltab[0]}\"/>\n  </radialGradient>\n  <filter id=\"f1\">\n    <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\".4\" />\n  </filter>\n</defs>\n<g id=\"p1\">\n  <rect x=\"${kw*.075}\" y=\"${kh*.075}\" width=\"${kw*.85}\" height=\"${kh*.85}\" rx=\"${mm*.1}\" ry=\"${mm*.1}\" fill=\"#000\"/>\n  <rect x=\"${kw*.1}\" y=\"${kh*.1}\" width=\"${kw*.8}\" height=\"${kh*.8}\" rx=\"${mm*.1}\" ry=\"${mm*.1}\" fill=\"${this.coltab[1]}\"/>\n</g>\n<g id=\"p2\">\n  <circle cx=\"${kw*0.5}\" cy=\"${kh*0.5}\" r=\"${mm*0.35}\" stroke=\"#000\" stroke-width=\"${mm*.03}\" fill=\"${this.coltab[0]}\" filter=\"url(#f1)\"/>\n  <circle cx=\"${kw*0.5}\" cy=\"${kh*0.5}\" r=\"${mm*0.27}\" stroke=\"#000\" stroke-width=\"${mm*.03}\" fill=\"#000\" filter=\"url(#f1)\"/>\n  <rect x=\"${kw*.075}\" y=\"${kh*.075}\" width=\"${kw*.85}\" height=\"${kh*.85}\" rx=\"${mm*.1}\" ry=\"${mm*.1}\" fill=\"url(#g1)\"/>\n</g>\n<use href=\"#p1\" y=\"${kh}\"/>\n<use href=\"#p2\" y=\"${kh}\"/>\n<circle cx=\"${kw*.5}\" cy=\"${kh*1.5}\" r=\"${mm*.25}\" fill=\"url(#g2)\" filter=\"url(#f1)\"/>\n<circle cx=\"${kw*.5}\" cy=\"${kh*1.5}\" r=\"${mm*.25}\" fill=\"url(#g1)\"/>\n</svg>`;\n        this.srcurl=\"data:image/svg+xml;base64,\"+btoa(svg);\n      }\n      else\n        this.srcurl=this.src;\n      this.img.onload=()=>{\n        if(this.kw==null) this.kw=this.img.width;\n        if(this.kh==null) this.kh=this.img.height*0.5;\n        this.elem.style.backgroundImage = \"url(\"+this.srcurl+\")\";\n        this.elem.style.backgroundSize = \"100% 200%\";\n        this.elem.style.width=this.kw+\"px\";\n        this.elem.style.height=this.kh+\"px\";\n        this.redraw();\n      }\n      this.img.src=this.srcurl;\n    }\n    redraw() {\n      let style = this.elem.style;\n      if(this.value^this.invert)\n        style.backgroundPosition = \"0px -100%\";\n      else\n        style.backgroundPosition = \"0px 0px\";\n    }\n    setValue(v,f){\n      this.value=v;\n      this.checked=(!!v);\n      if(this.value!=this.oldvalue){\n        this.redraw();\n        this.showtip(0);\n        if(f){\n          this.sendEvent(\"input\");\n          this.sendEvent(\"change\");\n        }\n        this.oldvalue=this.value;\n      }\n    }\n    pointerdown(ev){\n      if(!this.enable)\n        return;\n      let e=ev;\n      if(ev.touches){\n        e = ev.changedTouches[0];\n        this.identifier=e.identifier;\n      }\n      else {\n        if(e.buttons!=1 && e.button!=0)\n          return;\n      }\n      this.elem.focus();\n      this.drag=1;\n      this.showtip(0);\n      let pointermove=(e)=>{\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n      let pointerup=(e)=>{\n        this.drag=0;\n        this.showtip(0);\n        window.removeEventListener('mousemove', pointermove);\n        window.removeEventListener('touchmove', pointermove, {passive:false});\n        window.removeEventListener('mouseup', pointerup);\n        window.removeEventListener('touchend', pointerup);\n        window.removeEventListener('touchcancel', pointerup);\n        document.body.removeEventListener('touchstart', preventScroll,{passive:false});\n        if(this.type==\"kick\"){\n          this.value=0;\n          this.checked=false;\n          this.redraw();\n          this.sendEvent(\"change\");\n        }\n        this.sendEvent(\"click\");\n        e.preventDefault();\n        e.stopPropagation();\n      }\n      let preventScroll=(e)=>{\n        e.preventDefault();\n      }\n      switch(this.type){\n      case \"kick\":\n        this.setValue(1);\n        this.sendEvent(\"change\");\n        break;\n      case \"toggle\":\n        if(e.ctrlKey || e.metaKey)\n          this.value=defvalue;\n        else\n          this.value=1-this.value;\n        this.checked=!!this.value;\n        this.sendEvent(\"change\");\n        break;\n      case \"radio\":\n        let els=document.querySelectorAll(\"webaudio-switch[type='radio'][group='\"+this.group+\"']\");\n        for(let i=0;i<els.length;++i){\n          if(els[i]==this)\n            els[i].setValue(1);\n          else\n            els[i].setValue(0);\n        }\n        this.sendEvent(\"change\");\n        break;\n      }\n\n      window.addEventListener('mouseup', pointerup);\n      window.addEventListener('touchend', pointerup);\n      window.addEventListener('touchcancel', pointerup);\n      document.body.addEventListener('touchstart', preventScroll,{passive:false});\n      this.redraw();\n      ev.preventDefault();\n      ev.stopPropagation();\n      return false;\n    }\n  });\n} catch(error){\n  console.log(\"webaudio-switch already defined\");\n}\n\ntry{\n  customElements.define(\"webaudio-param\", class WebAudioParam extends WebAudioControlsWidget {\n    constructor(){\n      super();\n      this.addEventListener(\"keydown\",this.keydown);\n      this.addEventListener(\"mousedown\",this.pointerdown,{passive:false});\n      this.addEventListener(\"touchstart\",this.pointerdown,{passive:false});\n      this.addEventListener(\"wheel\",this.wheel);\n      this.addEventListener(\"mouseover\",this.pointerover);\n      this.addEventListener(\"mouseout\",this.pointerout);\n      this.addEventListener(\"contextmenu\",this.contextMenu);\n    }\n    connectedCallback(){\n      let root;\n      if(this.attachShadow)\n        root=this.attachShadow({mode: 'open'});\n      else\n        root=this;\n      root.innerHTML=\n`<style>\n${this.basestyle}\n:host{\n  display:inline-block;\n  user-select:none;\n  margin:0;\n  padding:0;\n  font-family: sans-serif;\n  font-size: 8px;\n  cursor:pointer;\n  position:relative;\n  vertical-align:baseline;\n}\n.webaudio-param-body{\n  display:inline-block;\n  position:relative;\n  text-align:center;\n  background:none;\n  margin:0;\n  padding:0;\n  font-family:sans-serif;\n  font-size:11px;\n  vertical-align:bottom;\n  border:none;\n}\n</style>\n<input class='webaudio-param-body' value='0' tabindex='1' touch-action='none'/><div class='webaudioctrl-tooltip'></div>\n`;\n      this.elem=root.childNodes[2];\n      this.ttframe=root.childNodes[3];\n      this.enable=this.getAttr(\"enable\",1);\n      this._value=this.getAttr(\"value\",0); Object.defineProperty(this,\"value\",{get:()=>{return this._value},set:(v)=>{this._value=v;this.redraw()}});\n      this.defvalue=this.getAttr(\"defvalue\",0);\n      this._fontsize=this.getAttr(\"fontsize\",9); Object.defineProperty(this,\"fontsize\",{get:()=>{return this._fontsize},set:(v)=>{this._fontsize=v;this.setupImage()}});\n      this._src=this.getAttr(\"src\",opt.paramSrc); Object.defineProperty(this,\"src\",{get:()=>{return this._src},set:(v)=>{this._src=v;this.setupImage()}});\n      this.link=this.getAttr(\"link\",\"\");\n      this._width=this.getAttr(\"width\",opt.paramWidth); Object.defineProperty(this,\"width\",{get:()=>{return this._width},set:(v)=>{this._width=v;this.setupImage()}});\n      this._height=this.getAttr(\"height\",opt.paramHeight); Object.defineProperty(this,\"height\",{get:()=>{return this._height},set:(v)=>{this._height=v;this.setupImage()}});\n      this._colors=this.getAttr(\"colors\",opt.paramColors); Object.defineProperty(this,\"colors\",{get:()=>{return this._colors},set:(v)=>{this._colors=v;this.setupImage()}});\n      this.outline=this.getAttr(\"outline\",opt.outline);\n      this.rconv=this.getAttr(\"rconv\",null);\n      this.midiController={};\n      this.midiMode=\"normal\";\n      this.currentLink=null;\n      if(this.midicc) {\n        let ch = parseInt(this.midicc.substring(0, this.midicc.lastIndexOf(\".\"))) - 1;\n        let cc = parseInt(this.midicc.substring(this.midicc.lastIndexOf(\".\") + 1));\n        this.setMidiController(ch, cc);\n      }\n      this.setupImage();\n      if(window.webAudioControlsWidgetManager)\n//        window.webAudioControlsWidgetManager.updateWidgets();\n        window.webAudioControlsWidgetManager.addWidget(this);\n      this.fromLink=((e)=>{\n        this.setValue(e.target.convValue.toFixed(e.target.digits));\n      }).bind(this);\n      this.elem.onchange=()=>{\n        if(!this.currentLink.target.conv || (this.currentLink.target.conv&&this.rconv)){\n          let val = this.value=this.elem.value;\n          if(this.rconv){\n            let x=+this.elem.value;\n            val=eval(this.rconv);\n          }\n          if(this.currentLink){\n            this.currentLink.target.setValue(val, true);\n          }\n        }\n      }\n    }\n    disconnectedCallback(){}\n    setupImage(){\n      this.imgloaded=()=>{\n        if(this.src!=\"\"&&this.src!=null){\n          this.elem.style.backgroundImage = \"url(\"+this.src+\")\";\n          this.elem.style.backgroundSize = \"100% 100%\";\n          if(this._width==null) this._width=this.img.width;\n          if(this._height==null) this._height=this.img.height;\n        }\n        else{\n          if(this._width==null) this._width=32;\n          if(this._height==null) this._height=20;\n        }\n        this.elem.style.width=this._width+\"px\";\n        this.elem.style.height=this._height+\"px\";\n        this.elem.style.fontSize=this.fontsize+\"px\";\n        let l=document.getElementById(this.link);\n        if(l&&typeof(l.value)!=\"undefined\"){\n          if(typeof(l.convValue)==\"number\")\n            this.setValue(l.convValue.toFixed(l.digits));\n          else\n            this.setValue(l.convValue);\n          if(this.currentLink)\n            this.currentLink.removeEventListener(\"input\",this.currentLink.func);\n          this.currentLink={target:l, func:(e)=>{\n            if(typeof(l.convValue)==\"number\")\n              this.setValue(l.convValue.toFixed(l.digits));\n            else\n              this.setValue(l.convValue);\n          }};\n          this.currentLink.target.addEventListener(\"input\",this.currentLink.func);\n  //        l.addEventListener(\"input\",(e)=>{this.setValue(l.convValue.toFixed(l.digits))});\n        }\n        this.redraw();\n      };\n      this.coltab = this.colors.split(\";\");\n      this.elem.style.color=this.coltab[0];\n      this.img=new Image();\n      this.img.onload=this.imgloaded.bind();\n      if(this.src==null){\n        this.elem.style.backgroundColor=this.coltab[1];\n        this.imgloaded();\n      }\n      else if(this.src==\"\"){\n        this.elem.style.background=\"none\";\n        this.imgloaded();\n      }\n      else{\n        this.img.src=this.src;\n      }\n    }\n    redraw() {\n      this.elem.value=this.value;\n    }\n    setValue(v,f){\n      this.value=v;\n      if(this.value!=this.oldvalue){\n        this.redraw();\n        this.showtip(0);\n        if(f){\n          let event=document.createEvent(\"HTMLEvents\");\n          event.initEvent(\"change\",false,true);\n          this.dispatchEvent(event);\n        }\n        this.oldvalue=this.value;\n      }\n    }\n    pointerdown(ev){\n      if(!this.enable)\n        return;\n      let e=ev;\n      if(ev.touches)\n          e = ev.touches[0];\n      else {\n        if(e.buttons!=1 && e.button!=0)\n          return;\n      }\n      this.elem.focus();\n      this.redraw();\n    }\n  });\n} catch(error){\n  console.log(\"webaudio-param already defined\");\n}\n\ntry{\n  customElements.define(\"webaudio-keyboard\", class WebAudioKeyboard extends WebAudioControlsWidget {\n    constructor(){\n      super();\n    }\n    connectedCallback(){\n      let root;\n      if(this.attachShadow)\n        root=this.attachShadow({mode: 'open'});\n      else\n        root=this;\n      root.innerHTML=\n`<style>\n${this.basestyle}\n:host{\n  display:inline-block;\n  position:relative;\n  margin:0;\n  padding:0;\n  font-family: sans-serif;\n  font-size: 11px;\n}\n.webaudio-keyboard-body{\n  display:inline-block;\n  margin:0;\n  padding:0;\n  vertical-align:bottom;\n}\n</style>\n<canvas class='webaudio-keyboard-body' tabindex='1' touch-action='none'></canvas><div class='webauioctrl-tooltip'></div>\n`;\n      this.elem=this.cv=root.childNodes[2];\n      this.ttframe=root.childNodes[3];\n      this.ctx=this.cv.getContext(\"2d\");\n      this._values=[];\n      this.enable=this.getAttr(\"enable\",1);\n      this._width=this.getAttr(\"width\",480); Object.defineProperty(this,\"width\",{get:()=>{return this._width},set:(v)=>{this._width=v;this.setupImage()}});\n      this._height=this.getAttr(\"height\",128); Object.defineProperty(this,\"height\",{get:()=>{return this._height},set:(v)=>{this._height=v;this.setupImage()}});\n      this._min=this.getAttr(\"min\",0); Object.defineProperty(this,\"min\",{get:()=>{return this._min},set:(v)=>{this._min=+v;this.redraw()}});\n      this._keys=this.getAttr(\"keys\",25); Object.defineProperty(this,\"keys\",{get:()=>{return this._keys},set:(v)=>{this._keys=+v;this.setupImage()}});\n      this._colors=this.getAttr(\"colors\",\"#222;#eee;#ccc;#333;#000;#e88;#c44;#c33;#800\"); Object.defineProperty(this,\"colors\",{get:()=>{return this._colors},set:(v)=>{this._colors=v;this.setupImage()}});\n      this.outline=this.getAttr(\"outline\",opt.outline);\n      this.midilearn=this.getAttr(\"midilearn\",0);\n      this.midicc=this.getAttr(\"midicc\",null);\n      this.press=0;\n      this.keycodes1=[90,83,88,68,67,86,71,66,72,78,74,77,188,76,190,187,191,226];\n      this.keycodes2=[81,50,87,51,69,82,53,84,54,89,55,85,73,57,79,48,80,192,222,219];\n      this.addEventListener(\"keyup\",this.keyup);\n      this.midiController={};\n      this.midiMode=\"normal\";\n      if(this.midicc) {\n          let ch = parseInt(this.midicc.substring(0, this.midicc.lastIndexOf(\".\"))) - 1;\n          let cc = parseInt(this.midicc.substring(this.midicc.lastIndexOf(\".\") + 1));\n          this.setMidiController(ch, cc);\n      }\n      this.setupImage();\n      this.digits=0;\n      if(this.step && this.step < 1) {\n        for(let n = this.step ; n < 1; n *= 10)\n          ++this.digits;\n      }\n      if(window.webAudioControlsWidgetManager)\n        window.webAudioControlsWidgetManager.addWidget(this);\n    }\n    disconnectedCallback(){}\n    setupImage(){\n      this.cv.style.width=this.width+\"px\";\n      this.cv.style.height=this.height+\"px\";\n      this.bheight = this.height * 0.55;\n      this.kp=[0,7/12,1,3*7/12,2,3,6*7/12,4,8*7/12,5,10*7/12,6];\n      this.kf=[0,1,0,1,0,0,1,0,1,0,1,0];\n      this.ko=[0,0,(7*2)/12-1,0,(7*4)/12-2,(7*5)/12-3,0,(7*7)/12-4,0,(7*9)/12-5,0,(7*11)/12-6];\n      this.kn=[0,2,4,5,7,9,11];\n      this.coltab=this.colors.split(\";\");\n      this.cv.width = this.width;\n      this.cv.height = this.height;\n      this.cv.style.width = this.width+'px';\n      this.cv.style.height = this.height+'px';\n      this.style.height = this.height+'px';\n      this.cv.style.outline=this.outline?\"\":\"none\";\n      this.bheight = this.height * 0.55;\n      this.max=this.min+this.keys-1;\n      this.dispvalues=[];\n      this.valuesold=[];\n      if(this.kf[this.min%12])\n        --this.min;\n      if(this.kf[this.max%12])\n        ++this.max;\n      this.redraw();\n    }\n    redraw(){\n      function rrect(ctx, x, y, w, h, r, c1, c2) {\n        if(c2) {\n          let g=ctx.createLinearGradient(x,y,x+w,y);\n          g.addColorStop(0,c1);\n          g.addColorStop(1,c2);\n          ctx.fillStyle=g;\n        }\n        else\n          ctx.fillStyle=c1;\n        ctx.beginPath();\n        ctx.moveTo(x, y);\n        ctx.lineTo(x+w, y);\n        ctx.lineTo(x+w, y+h-r);\n        ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);\n        ctx.lineTo(x+r, y+h);\n        ctx.quadraticCurveTo(x, y+h, x, y+h-r);\n        ctx.lineTo(x, y);\n        ctx.fill();\n      }\n      this.ctx.fillStyle = this.coltab[0];\n      this.ctx.fillRect(0,0,this.width,this.height);\n      let x0=7*((this.min/12)|0)+this.kp[this.min%12];\n      let x1=7*((this.max/12)|0)+this.kp[this.max%12];\n      let n=x1-x0;\n      this.wwidth=(this.width-1)/(n+1);\n      this.bwidth=this.wwidth*7/12;\n      let h2=this.bheight;\n      let r=Math.min(8,this.wwidth*0.2);\n      for(let i=this.min,j=0;i<=this.max;++i) {\n        if(this.kf[i%12]==0) {\n          let x=this.wwidth*(j++)+1;\n          if(this.dispvalues.indexOf(i)>=0)\n            rrect(this.ctx,x,1,this.wwidth-1,this.height-2,r,this.coltab[5],this.coltab[6]);\n          else\n            rrect(this.ctx,x,1,this.wwidth-1,this.height-2,r,this.coltab[1],this.coltab[2]);\n        }\n      }\n      r=Math.min(8,this.bwidth*0.3);\n      for(let i=this.min;i<this.max;++i) {\n        if(this.kf[i%12]) {\n          let x=this.wwidth*this.ko[this.min%12]+this.bwidth*(i-this.min)+1;\n          if(this.dispvalues.indexOf(i)>=0)\n            rrect(this.ctx,x,1,this.bwidth,h2,r,this.coltab[7],this.coltab[8]);\n          else\n            rrect(this.ctx,x,1,this.bwidth,h2,r,this.coltab[3],this.coltab[4]);\n          this.ctx.strokeStyle=this.coltab[0];\n          this.ctx.stroke();\n        }\n      }\n    }\n    _setValue(v){\n      if(this.step)\n        v=(Math.round((v-this.min)/this.step))*this.step+this.min;\n      this._value=Math.min(this.max,Math.max(this.min,v));\n      if(this._value!=this.oldvalue){\n        this.oldvalue=this._value;\n        this.redraw();\n        this.showtip(0);\n        return 1;\n      }\n      return 0;\n    }\n    setValue(v,f){\n      if(this._setValue(v) && f)\n        this.sendEvent(\"input\"),this.sendEvent(\"change\");\n    }\n    wheel(e){}\n    keydown(e){\n      let m=Math.floor((this.min+11)/12)*12;\n      let k=this.keycodes1.indexOf(e.keyCode);\n      if(k<0) {\n        k=this.keycodes2.indexOf(e.keyCode);\n        if(k>=0) k+=12;\n      }\n      if(k>=0){\n        k+=m;\n        if(this.currentKey!=k){\n          this.currentKey=k;\n          this.sendEventFromKey(1,k);\n          this.setNote(1,k);\n        }\n      }\n    }\n    keyup(e){\n      let m=Math.floor((this.min+11)/12)*12;\n      let k=this.keycodes1.indexOf(e.keyCode);\n      if(k<0) {\n        k=this.keycodes2.indexOf(e.keyCode);\n        if(k>=0) k+=12;\n      }\n      if(k>=0){\n        k+=m;\n        this.currentKey=-1;\n        this.sendEventFromKey(0,k);\n        this.setNote(0,k);\n      }\n    }\n    pointerdown(ev){\n      this.cv.focus();\n      if(this.enable) {\n        ++this.press;\n      }\n      let pointermove=(ev)=>{\n        if(!this.enable)\n          return;\n        let r=this.getBoundingClientRect();\n        let v=[],p;\n        if(ev.touches)\n          p=ev.targetTouches;\n        else if(this.press)\n          p=[ev];\n        else\n          p=[];\n        if(p.length>0)\n          this.drag=1;\n        for(let i=0;i<p.length;++i) {\n          let px=p[i].clientX-r.left;\n          let py=p[i].clientY-r.top;\n          let x,k,ko;\n          if(py>=0&&py<this.height){\n            if(py<this.bheight) {\n              x=px-this.wwidth*this.ko[this.min%12];\n              k=this.min+((x/this.bwidth)|0);\n            }\n            else {\n              k=(px/this.wwidth)|0;\n              ko=this.kp[this.min%12];\n              k+=ko;\n              k=this.min+((k/7)|0)*12+this.kn[k%7]-this.kn[ko%7];\n            }\n            if(k>=this.min&&k<=this.max)\n              v.push(k);\n          }\n        }\n        v.sort();\n        this.values=v;\n        this.sendevent();\n        this.redraw();\n      }\n        \n      let pointerup=(ev)=>{\n        if(this.enable) {\n          if(ev.touches)\n            this.press=ev.touches.length;\n          else\n            this.press=0;\n          pointermove(ev);\n          this.sendevent();\n          if(this.press==0){\n            window.removeEventListener('mousemove', pointermove);\n            window.removeEventListener('touchmove', pointermove, {passive:false});\n            window.removeEventListener('mouseup', pointerup);\n            window.removeEventListener('touchend', pointerup);\n            window.removeEventListener('touchcancel', pointerup);\n            document.body.removeEventListener('touchstart', preventScroll,{passive:false});\n          }\n          this.redraw();\n        }\n        this.drag=0;\n        ev.preventDefault();\n      }\n      let preventScroll=(ev)=>{\n        ev.preventDefault();\n      }\n      window.addEventListener('mousemove', pointermove);\n      window.addEventListener('touchmove', pointermove, {passive:false});\n      window.addEventListener('mouseup', pointerup);\n      window.addEventListener('touchend', pointerup);\n      window.addEventListener('touchcancel', pointerup);\n      document.body.addEventListener('touchstart', preventScroll,{passive:false});\n      pointermove(ev);\n      ev.preventDefault();\n      ev.stopPropagation();\n    }\n    sendEventFromKey(s,k){\n      let ev=document.createEvent('HTMLEvents');\n      ev.initEvent('change',true,true);\n      ev.note=[s,k];\n      this.dispatchEvent(ev);\n    }\n    sendevent(){\n      let notes=[];\n      for(let i=0,j=this.valuesold.length;i<j;++i) {\n        if(this.values.indexOf(this.valuesold[i])<0)\n          notes.push([0,this.valuesold[i]]);\n      }\n      for(let i=0,j=this.values.length;i<j;++i) {\n        if(this.valuesold.indexOf(this.values[i])<0)\n          notes.push([1,this.values[i]]);\n      }\n      if(notes.length) {\n        this.valuesold=this.values;\n        for(let i=0;i<notes.length;++i) {\n          this.setdispvalues(notes[i][0],notes[i][1]);\n          let ev=document.createEvent('HTMLEvents');\n          ev.initEvent('change',true,true);\n          ev.note=notes[i];\n          this.dispatchEvent(ev);\n        }\n      }\n    }\n    setdispvalues(state,note) {\n      let n=this.dispvalues.indexOf(note);\n      if(state) {\n        if(n<0) this.dispvalues.push(note);\n      }\n      else {\n        if(n>=0) this.dispvalues.splice(n,1);\n      }\n    }\n    setNote(state,note,actx,when) {\n      const t=(actx&&when-actx.currentTime);\n      if(t>0){\n        setTimeout(()=>{this.setNote(state,note)},t*1000);\n      }\n      else{\n        this.setdispvalues(state,note);\n        this.redraw();\n      }\n    }  });\n} catch(error){\n  console.log(\"webaudio-keyboard already defined\");\n}\n\n  class WebAudioControlsWidgetManager {\n    constructor(){\n      this.midiAccess = null;\n      this.listOfWidgets = [];\n      this.listOfExternalMidiListeners = [];\n      this.updateWidgets();\n      if(opt.preserveMidiLearn)\n        this.midiLearnTable=JSON.parse(localStorage.getItem(\"WebAudioControlsMidiLearn\"));\n      else\n        this.midiLearnTable=null;\n      this.initWebAudioControls();\n    }\n    addWidget(w){\n      this.listOfWidgets.push(w);\n    }\n    updateWidgets(){\n//      this.listOfWidgets = document.querySelectorAll(\"webaudio-knob,webaudio-slider,webaudio-switch\");\n    }\n    initWebAudioControls() {\n      if(navigator.requestMIDIAccess) {\n        navigator.requestMIDIAccess().then(\n          (ma)=>{this.midiAccess = ma,this.enableInputs()},\n          (err)=>{ console.log(\"MIDI not initialized - error encountered:\" + err.code)}\n        );\n      }\n    }\n    enableInputs() {\n      let inputs = this.midiAccess.inputs.values();\n      console.log(\"Found \" + this.midiAccess.inputs.size + \" MIDI input(s)\");\n      for(let input = inputs.next(); input && !input.done; input = inputs.next()) {\n        console.log(\"Connected input: \" + input.value.name);\n        input.value.onmidimessage = this.handleMIDIMessage.bind(this);\n      }\n    }\n    midiConnectionStateChange(e) {\n      console.log(\"connection: \" + e.port.name + \" \" + e.port.connection + \" \" + e.port.state);\n      enableInputs();\n    }\n\n    onMIDIStarted(midi) {\n      this.midiAccess = midi;\n      midi.onstatechange = this.midiConnectionStateChange;\n      enableInputs(midi);\n    }\n    // Add hooks for external midi listeners support\n    addMidiListener(callback) {\n      this.listOfExternalMidiListeners.push(callback);\n    }\n    getCurrentConfigAsJSON() {\n      return currentConfig.stringify();\n    }\n    handleMIDIMessage(event) {\n      this.listOfExternalMidiListeners.forEach(function (externalListener) {\n        externalListener(event);\n      });\n      if(((event.data[0] & 0xf0) == 0xf0) || ((event.data[0] & 0xf0) == 0xb0 && event.data[1] >= 120))\n        return;\n      for(let w of this.listOfWidgets) {\n        if(w.processMidiEvent)\n          w.processMidiEvent(event);\n      }\n      if(opt.mididump)\n        console.log(event.data);\n    }\n    contextMenuOpen(e,knob){\n      if(!this.midiAccess)\n        return;\n      let menu=document.getElementById(\"webaudioctrl-context-menu\");\n      menu.style.left=e.pageX+\"px\";\n      menu.style.top=e.pageY+\"px\";\n      menu.knob=knob;\n      menu.classList.add(\"active\");\n      menu.knob.focus();\n      menu.knob.addEventListener(\"keydown\",this.contextMenuCloseByKey.bind(this));\n    }\n    contextMenuCloseByKey(e){\n      if(e.keyCode==27)\n       this.contextMenuClose();\n    }\n    contextMenuClose(){\n      let menu=document.getElementById(\"webaudioctrl-context-menu\");\n      menu.knob.removeEventListener(\"keydown\",this.contextMenuCloseByKey);\n      menu.classList.remove(\"active\");\n      let menuItemLearn=document.getElementById(\"webaudioctrl-context-menu-learn\");\n      menuItemLearn.innerHTML = 'Learn';\n      menu.knob.midiMode = 'normal';\n    }\n    contextMenuLearn(){\n      let menu=document.getElementById(\"webaudioctrl-context-menu\");\n      let menuItemLearn=document.getElementById(\"webaudioctrl-context-menu-learn\");\n      menuItemLearn.innerHTML = 'Listening...';\n      menu.knob.midiMode = 'learn';\n    }\n    contextMenuClear(e){\n      let menu=document.getElementById(\"webaudioctrl-context-menu\");\n      menu.knob.midiController={};\n      this.contextMenuClose();\n    }\n    preserveMidiLearn(){\n      if(!opt.preserveMidiLearn)\n        return;\n      const v=[];\n      for(let w of this.listOfWidgets) {\n        if(w.id)\n          v.push({\"id\":w.id, \"cc\":w.midiController});\n      }\n      const s=JSON.stringify(v);\n      localStorage.setItem(\"WebAudioControlsMidiLearn\",s);\n    }\n  }\n  if(window.UseWebAudioControlsMidi||opt.useMidi)\n    window.webAudioControlsWidgetManager = window.webAudioControlsMidiManager = new WebAudioControlsWidgetManager();\n}\n"]}